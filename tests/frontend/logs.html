<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>JSON EHR Utils - Log Viewer</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 6px;
        }

        .log-entry {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h1>üîê Encrypted Logs</h1>
    <button id="loadLogs">Load Logs</button>
    <div id="logsContainer"></div>

    <script>
    document.getElementById("loadLogs").addEventListener("click", async () => {
        try {
            const res = await fetch("http://localhost:4000/v1/logs", {
                headers: {
                    "Authorization": "Bearer my-secret-api-key"
                }
            });

            if (!res.ok) {
                throw new Error("Failed to fetch logs");
            }

            const logs = await res.json();
            const container = document.getElementById("logsContainer");
            container.innerHTML = "";

            logs.forEach((log, idx) => {
                let logObj;
                try {
                    logObj = JSON.parse(log);
                } catch {
                    logObj = { error: "Malformed log", raw: log };
                }
                const div = document.createElement("div");
                div.className = "log-entry";
                div.innerHTML = `
                    <h3>Log #${idx + 1} - ${logObj.time || "unknown time"}</h3>
                    <p><strong>Method:</strong> ${logObj.method || ""} <strong>URL:</strong> ${logObj.url || ""}</p>
                    <pre>${JSON.stringify(logObj.headers, null, 2)}</pre>
                `;
                container.appendChild(div);
            });

        } catch (err) {
            console.error("Error loading logs:", err);
        }
    });
</script>

</body>

</html>